# This is a basic workflow to help you get started with Actions

name: Build Cloud Agent
on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      # Checks-out your repository under $GITHUB_WORKSPACE, so your job can access it
      - uses: actions/checkout@v2
        with :
          repository: bosch/swdc-os-cloud-agent
          path: cloudagent
          token: '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'
          ref: 'add_build_actions'

      - name: Set up Go
        uses: actions/setup-go@v2
        with:
            go-version: 1.17
        
      # Runs a single command using the runners shell
      - name: Run build script
        run: | 
          cd $GITHUB_WORKSPACE/cloudagent/cmd/azure
          ./build.sh

      # Runs a set of commands using the runners shell
      - name: Check build
        run: |
          cd $GITHUB_WORKSPACE/cloudagent/cmd/azure/target/natives/linux-arm64
          ls -l
          
      - name: Commit
      - uses: actions/checkout@v2
      
      - name : Commit
        run: |
            git config --global user.name 'Your Name'
            git config --global user.email 'your-username@users.noreply.github.com'
            git add $GITHUB_WORKSPACE/cloudagent/cmd/azure/target/natives/linux-arm64/cloudagent
            git commit -am "Automated report"
            git push
      

